<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css" />
    <link rel="stylesheet" href="/style.css">
    <title>My Notes</title>
  </head>
  <body>
    <%- include('../partials/_navbar.ejs') %>
    <h1>My Notes</h1>

    <div class="notes-container">
        <% notes.forEach(note => { %>
            <div class="note">
                <h4><%= note.title %></h4>
                 <p><%= note.content %></p>
                 <input value="<%= note._id %>" type="hidden">
            </div>
        <%}); %>
    </div>



    <!-- The Modal -->
    <div id="myModal" class="modal">
    <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <form action="" method="POST" id="form-update">
          <input type="text" name="title" id="edit-modal-title">
          <textarea type="text" name="content" id="edit-modal-content"></textarea>
          <button type="submit">Update</button>
          <!-- <button type="submit">Delete</button> -->
        </form>


        <form action="" method="POST" id="form-delete">
          <!-- <input type="text" name="title" id="delete-modal-title"> -->
          <!-- <textarea type="text" name="content" id="delete-modal-content"></textarea> -->
          <button type="submit">Delete</button>
        </form>
      </div>
    </div>

    <a href="notes/new">Add New Note</a>

    <script>
      // Get the modal
      var modal = document.getElementById("myModal");
  
      // Get the button that opens the modal
      // var btn = document.getElementById("myBtn");
  
      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];
  
      // When the user clicks the button, open the modal
      document.querySelectorAll("div .note")
      .forEach(element => {
        element.onclick = function() {
          modal.style.display = "block";
          document.getElementById("edit-modal-title").value = element.children[0].innerHTML;
          document.getElementById("edit-modal-content").value = element.children[1].innerHTML;
          document.querySelector(".modal-content #form-update").action = `/users/<%= user._id%>/notes/${element.children[2].value}?_method=PUT`;
          document.querySelector(".modal-content #form-delete").action = `/users/<%= user._id%>/notes/${element.children[2].value}?_method=DELETE`;
          // notes/user._id?_method=DELETE
        }
      })
      
  
      // When the user clicks on <span> (x), close the modal
      span.onclick = function() {
        modal.style.display = "none";
      }
  
      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
  </script>
  </body>
</html>
